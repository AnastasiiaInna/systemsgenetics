```{r}
library(ggplot2)
library(gridExtra)
library(readxl)
library(pheatmap)
library(RColorBrewer)
library(gridExtra)
library(data.table)
library(qqman)
source("depict2_functions.r")

path <- "/home/work/Desktop/depict2/output/simulated_gwas//"

#files <- list.files(path, pattern="*merged_pvalues.txt", full.names = T)
#curstats <- fread(files[1], data.table=F)

files <- list.files(path, pattern="*merged_assoc.txt.gz", full.names = T)
curstats <- fread(paste0("zcat ",files[2]), data.table=F)
rownames(curstats) <- make.names(curstats$rs, unique=T)

height <- fread("zcat ~/Desktop/depict2/Meta-analysis_Wood_et_al+UKBiobank_2018_formatted.txt.gz", data.table=F)
```

# Pvalue evaluation
```{r}
par(mfrow=c(2,2))
hist(curstats[,"simulated_pval_1"])
hist(height[,2])

hist(-log10(curstats[,"simulated_pval_1"]), breaks=100)
hist(-log10(height[,2]), breaks=100)

```

# Manhattan plot
```{r}
curstats[-log10(curstats$simulated_pval_1) > 300, "simulated_pval_1"] <- 1e-300
png(width=10000, height=3000, file="output/plots/run_41_manhattanplot.png")
manhattan(curstats, chr="chr", bp="position", snp="rs", p="simulated_pval_1")
dev.off()

rownames(height) <- height[,1]
ol <- intersect(rownames(height), curstats$rs)
h <- cbind(curstats[ol,c("rs", "chr", "position")], height[ol,2])
colnames(h) <- c("rs", "chr", "position", "simulated_pval_1")

h[-log10(h$simulated_pval_1) > 300, "simulated_pval_1"] <- 300
png(width=10000, height=3000, file="output/plots/height_manhattanplot.png")
manhattan(h, chr="chr", bp="position", snp="rs", p="simulated_pval_1")
dev.off()

```

# Height odds ratio's
```{r}
height <- fread("zcat ~/Desktop/depict2/Meta-analysis_Wood_et_al+UKBiobank_2018.txt.gz", data.table=F)

ors.rand <- c(rnorm(mean = 1, sd=0.05, n=100000), rnorm(mean = 1, sd=0.012, n=100000))
plot(density(scale(height$BETA)), xlim=c(-23.74065,  19.52504), col="blue", lwd=2, xlab="centered and scaled beta's / OR")
lines(density(scale(ors.rand)), col="red", lwd=3)
legend("topleft", legend=c("height betas", "simulated dist"), fill=c("blue", "red"))


hist(ors.rand)
```


